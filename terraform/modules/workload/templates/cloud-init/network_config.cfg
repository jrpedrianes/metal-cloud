version: 2
ethernets:
%{ for network_key, network_value in networks ~}
  ens${network_key+3}:
    addresses:
      - ${network_value.network_attachment.address}
%{ if network_value.network_attachment.default == true ~}
    routes:
      - to: default
        via: ${network_value.network_info.gateway_address}
%{ endif ~}
    nameservers:
      addresses: [4.4.4.4, 8.8.8.8]
      search:
        - ${network_value.network_info.name}.${network_value.network_info.mode}.local
%{ endfor ~}
